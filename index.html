<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Availability Collector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar-day {
            transition: all 0.2s ease;
        }
        .calendar-day:hover:not(.past-date) {
            transform: scale(1.05);
        }
        .selected {
            background-color: #4ade80 !important;
            color: #064e3b !important;
        }
        .past-date {
            background-color: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
        }
        .person-tag {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .date-chip {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .highlight-date {
            background-color: #c7d2fe;
            border: 2px solid #4f46e5;
        }
        .toast {
            animation: toastIn 0.3s ease-out forwards, toastOut 0.3s ease-in forwards 3s;
            pointer-events: none;
        }
        @keyframes toastIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes toastOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        .log-entry {
            animation: fadeInUp 0.4s ease-out;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4 md:p-8">
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
        Data saved successfully!
    </div>

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden mb-8">
        <div class="bg-indigo-600 text-white p-6">
            <h1 class="text-2xl md:text-3xl font-bold">Date Availability Collector</h1>
            <p class="mt-2 opacity-90">Coordinate dates with your friends, one month at a time</p>
        </div>
        
        <div class="p-6">
            <!-- Month Navigation -->
            <div class="flex justify-between items-center mb-6">
                <button id="prevMonth" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-800 px-4 py-2 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                    Previous
                </button>
                <h2 id="currentMonth" class="text-xl md:text-2xl font-semibold text-gray-800"></h2>
                <button id="nextMonth" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-800 px-4 py-2 rounded-lg flex items-center">
                    Next
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </button>
            </div>
            
            <!-- Calendar -->
            <div class="mb-8">
                <div class="grid grid-cols-7 gap-1 mb-2 text-center">
                    <div class="font-medium text-gray-500">Sun</div>
                    <div class="font-medium text-gray-500">Mon</div>
                    <div class="font-medium text-gray-500">Tue</div>
                    <div class="font-medium text-gray-500">Wed</div>
                    <div class="font-medium text-gray-500">Thu</div>
                    <div class="font-medium text-gray-500">Fri</div>
                    <div class="font-medium text-gray-500">Sat</div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-1"></div>
            </div>
            
            <!-- Name Input -->
            <div class="mb-6">
                <label for="nameInput" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                <div class="flex">
                    <input type="text" id="nameInput" class="flex-grow border border-gray-300 rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your name">
                    <button id="saveButton" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-r-lg transition-colors">
                        Save My Availability
                    </button>
                </div>
            </div>
            
            <!-- Participants -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Participants</h3>
                <div id="participantsList" class="space-y-3">
                    <!-- Participants will be listed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Availability Section -->
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden mb-8">
        <div class="bg-indigo-600 text-white p-4">
            <h2 class="text-xl font-bold">Detailed Availability</h2>
        </div>
        <div class="p-6">
            <div id="detailedAvailability" class="space-y-4">
                <!-- Detailed availability will be shown here -->
            </div>
        </div>
    </div>

    <!-- Common Dates Section -->
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden mb-8">
        <div class="bg-green-600 text-white p-4">
            <h2 class="text-xl font-bold">Common Availability</h2>
        </div>
        <div class="p-6">
            <div id="commonDates" class="space-y-4">
                <!-- Common dates will be shown here -->
            </div>
        </div>
    </div>
     <!-- Submission Log Section -->
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden mb-8">
        <div class="bg-blue-600 text-white p-4 flex justify-between items-center">
            <h2 class="text-xl font-bold">Submission Log</h2>
            <button id="toggleLogButton" class="bg-blue-500 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm">
                Show/Hide
            </button>
        </div>
        <div id="logContainer" class="p-6">
            <div id="submissionLog" class="space-y-2">
                <!-- Submission log will be shown here -->
            </div>
        </div>
    </div>

    <!-- Local Storage Notice -->
    <div class="max-w-4xl mx-auto bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-8">
        <div class="flex items-start">
            <div class="flex-shrink-0 pt-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800">Important Note About Data Storage</h3>
                <div class="mt-1 text-sm text-yellow-700">
                    <p>This app stores data in your browser's local storage. This means:</p>
                    <ul class="list-disc pl-5 mt-1 space-y-1">
                        <li>Data is only visible on the device and browser you're currently using</li>
                        <li>Other people using different devices won't see your submissions</li>
                        <li>For shared viewing, everyone needs to use the same device/browser</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Clear All Data Button -->
    <div class="max-w-4xl mx-auto mb-8 flex justify-center">
        <button id="clearAllButton" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            Clear All Availability Data
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize variables
            let currentDate = new Date();
            let selectedDates = [];
            let participants = [];
            let submissionLog = [];
            
            // DOM elements
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonthElement = document.getElementById('currentMonth');
            const prevMonthButton = document.getElementById('prevMonth');
            const nextMonthButton = document.getElementById('nextMonth');
            const nameInput = document.getElementById('nameInput');
            const saveButton = document.getElementById('saveButton');
            const participantsList = document.getElementById('participantsList');
            const detailedAvailability = document.getElementById('detailedAvailability');
            const commonDates = document.getElementById('commonDates');
            const submissionLogElement = document.getElementById('submissionLog');
            const clearAllButton = document.getElementById('clearAllButton');
            const toast = document.getElementById('toast');
            const toggleLogButton = document.getElementById('toggleLogButton');
            const logContainer = document.getElementById('logContainer');
            
            // Load saved data from localStorage
            loadFromLocalStorage();
            
            // Initialize calendar
            renderCalendar();
            
            // Event listeners
            prevMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
            
            nextMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
            
            saveButton.addEventListener('click', saveAvailability);
            
            clearAllButton.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all availability data? This cannot be undone.')) {
                    participants = [];
                    submissionLog = [];
                    saveToLocalStorage();
                    renderCalendar();
                    renderParticipants();
                    renderDetailedAvailability();
                    renderCommonDates();
                    renderSubmissionLog();
                    showToast('All data has been cleared');
                }
            });
            
            toggleLogButton.addEventListener('click', () => {
                if (logContainer.style.display === 'none') {
                    logContainer.style.display = 'block';
                } else {
                    logContainer.style.display = 'none';
                }
            });
            
            // Functions
            function renderCalendar() {
                // Clear previous calendar
                calendarGrid.innerHTML = '';
                
                // Update month display
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                                   'July', 'August', 'September', 'October', 'November', 'December'];
                currentMonthElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
                
                // Get first day of month and total days
                const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                const totalDays = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
                
                // Add empty cells for days before the first day of the month
                for (let i = 0; i < startingDayOfWeek; i++) {
                    const emptyCell = document.createElement('div');
                    calendarGrid.appendChild(emptyCell);
                }
                
                // Add cells for each day of the month
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let day = 1; day <= totalDays; day++) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    const dateString = formatDate(date);
                    const isPastDate = date < today;
                    
                    const dayCell = document.createElement('div');
                    dayCell.className = `calendar-day h-16 md:h-20 border rounded-lg flex flex-col ${
                        isPastDate ? 'past-date' : 'cursor-pointer bg-indigo-50 hover:bg-indigo-100'
                    }`;
                    dayCell.dataset.date = dateString;
                    
                    // Day number
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'text-right p-1 font-medium';
                    dayNumber.textContent = day;
                    dayCell.appendChild(dayNumber);
                    
                    // Container for participant tags
                    const tagsContainer = document.createElement('div');
                    tagsContainer.className = 'flex flex-wrap gap-1 p-1 overflow-hidden';
                    dayCell.appendChild(tagsContainer);
                    
                    // Add participant tags if any are available for this date
                    participants.forEach(participant => {
                        if (participant.dates.includes(dateString)) {
                            const tag = document.createElement('div');
                            tag.className = 'person-tag text-xs bg-indigo-500 text-white px-1 rounded truncate max-w-full';
                            tag.textContent = participant.name;
                            tagsContainer.appendChild(tag);
                        }
                    });
                    
                    if (!isPastDate) {
                        dayCell.addEventListener('click', () => toggleDateSelection(dayCell, dateString));
                    }
                    
                    calendarGrid.appendChild(dayCell);
                }
                
                // Reset selected dates when changing months
                selectedDates = [];
                
                // Highlight common dates on the calendar
                highlightCommonDates();
            }
            
            function toggleDateSelection(dayCell, dateString) {
                const index = selectedDates.indexOf(dateString);
                
                if (index === -1) {
                    // Add date
                    selectedDates.push(dateString);
                    dayCell.classList.add('selected');
                } else {
                    // Remove date
                    selectedDates.splice(index, 1);
                    dayCell.classList.remove('selected');
                }
            }
            
            function saveAvailability() {
                const name = nameInput.value.trim();
                
                if (!name) {
                    alert('Please enter your name');
                    return;
                }
                
                if (selectedDates.length === 0) {
                    alert('Please select at least one date');
                    return;
                }
                
                // Sort selected dates
                selectedDates.sort();
                
                // Check if participant already exists
                const existingIndex = participants.findIndex(p => p.name === name);
                let isUpdate = false;
                
                if (existingIndex !== -1) {
                    // Update existing participant
                    isUpdate = true;
                    participants[existingIndex].dates = selectedDates.slice();
                } else {
                    // Add new participant
                    participants.push({
                        name: name,
                        dates: selectedDates.slice()
                    });
                }
                
                // Add to submission log
                const now = new Date();
                submissionLog.push({
                    name: name,
                    timestamp: now.toISOString(),
                    action: isUpdate ? 'updated' : 'submitted',
                    dateCount: selectedDates.length
                });
                
                // Save to localStorage
                saveToLocalStorage();
                
                // Show toast notification
                showToast(`Availability ${isUpdate ? 'updated' : 'saved'} successfully!`);
                
                // Clear selection and input
                nameInput.value = '';
                selectedDates = [];
                
                // Re-render everything
                renderCalendar();
                renderParticipants();
                renderDetailedAvailability();
                renderCommonDates();
                renderSubmissionLog();
            }
            
            function renderParticipants() {
                participantsList.innerHTML = '';
                
                if (participants.length === 0) {
                    const emptyMessage = document.createElement('p');
                    emptyMessage.className = 'text-gray-500 italic';
                    emptyMessage.textContent = 'No participants yet';
                    participantsList.appendChild(emptyMessage);
                    return;
                }
                
                participants.forEach((participant, index) => {
                    const participantCard = document.createElement('div');
                    participantCard.className = 'bg-gray-50 rounded-lg p-3 flex justify-between items-start';
                    
                    const infoDiv = document.createElement('div');
                    
                    const nameElement = document.createElement('h4');
                    nameElement.className = 'font-medium text-gray-800';
                    nameElement.textContent = participant.name;
                    infoDiv.appendChild(nameElement);
                    
                    const datesElement = document.createElement('p');
                    datesElement.className = 'text-sm text-gray-600 mt-1';
                    datesElement.textContent = `Available on ${participant.dates.length} date${participant.dates.length !== 1 ? 's' : ''}`;
                    infoDiv.appendChild(datesElement);
                    
                    participantCard.appendChild(infoDiv);
                    
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'text-red-500 hover:text-red-700';
                    deleteButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    `;
                    deleteButton.addEventListener('click', () => {
                        // Add to log before removing
                        submissionLog.push({
                            name: participant.name,
                            timestamp: new Date().toISOString(),
                            action: 'removed',
                            dateCount: 0
                        });
                        
                        participants.splice(index, 1);
                        saveToLocalStorage();
                        renderCalendar();
                        renderParticipants();
                        renderDetailedAvailability();
                        renderCommonDates();
                        renderSubmissionLog();
                        showToast('Participant removed');
                    });
                    
                    participantCard.appendChild(deleteButton);
                    participantsList.appendChild(participantCard);
                });
            }
            
            function renderDetailedAvailability() {
                detailedAvailability.innerHTML = '';
                
                if (participants.length === 0) {
                    const emptyMessage = document.createElement('p');
                    emptyMessage.className = 'text-gray-500 italic';
                    emptyMessage.textContent = 'No availability data yet';
                    detailedAvailability.appendChild(emptyMessage);
                    return;
                }
                
                participants.forEach(participant => {
                    const participantSection = document.createElement('div');
                    participantSection.className = 'border rounded-lg p-4';
                    
                    const nameHeader = document.createElement('h3');
                    nameHeader.className = 'font-medium text-lg text-gray-800 mb-2';
                    nameHeader.textContent = participant.name;
                    participantSection.appendChild(nameHeader);
                    
                    if (participant.dates.length === 0) {
                        const noDates = document.createElement('p');
                        noDates.className = 'text-gray-500 italic';
                        noDates.textContent = 'No dates selected';
                        participantSection.appendChild(noDates);
                    } else {
                        const datesContainer = document.createElement('div');
                        datesContainer.className = 'flex flex-wrap gap-2';
                        
                        participant.dates.forEach(dateString => {
                            const dateChip = document.createElement('div');
                            dateChip.className = 'date-chip bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm';
                            dateChip.textContent = formatDisplayDate(dateString);
                            datesContainer.appendChild(dateChip);
                        });
                        
                        participantSection.appendChild(datesContainer);
                    }
                    
                    detailedAvailability.appendChild(participantSection);
                });
            }
            
            function renderCommonDates() {
                commonDates.innerHTML = '';
                
                if (participants.length < 2) {
                    const emptyMessage = document.createElement('p');
                    emptyMessage.className = 'text-gray-500 italic';
                    emptyMessage.textContent = 'Need at least 2 participants to find common dates';
                    commonDates.appendChild(emptyMessage);
                    return;
                }
                
                // Find all unique dates
                const allDates = new Set();
                participants.forEach(participant => {
                    participant.dates.forEach(date => allDates.add(date));
                });
                
                // Count availability for each date
                const dateAvailability = {};
                allDates.forEach(date => {
                    dateAvailability[date] = {
                        count: 0,
                        people: []
                    };
                });
                
                participants.forEach(participant => {
                    participant.dates.forEach(date => {
                        dateAvailability[date].count++;
                        dateAvailability[date].people.push(participant.name);
                    });
                });
                
                // Sort dates by count (most available first)
                const sortedDates = Object.keys(dateAvailability).sort((a, b) => {
                    // First by count (descending)
                    if (dateAvailability[b].count !== dateAvailability[a].count) {
                        return dateAvailability[b].count - dateAvailability[a].count;
                    }
                    // Then by date (ascending)
                    return a.localeCompare(b);
                });
                
                // Group dates by availability count
                const groupedDates = {};
                sortedDates.forEach(date => {
                    const count = dateAvailability[date].count;
                    if (!groupedDates[count]) {
                        groupedDates[count] = [];
                    }
                    groupedDates[count].push({
                        date,
                        people: dateAvailability[date].people
                    });
                });
                
                // Display grouped dates
                const counts = Object.keys(groupedDates).sort((a, b) => b - a);
                
                if (counts.length === 0) {
                    const emptyMessage = document.createElement('p');
                    emptyMessage.className = 'text-gray-500 italic';
                    emptyMessage.textContent = 'No common dates found';
                    commonDates.appendChild(emptyMessage);
                    return;
                }
                
                counts.forEach(count => {
                    const group = document.createElement('div');
                    group.className = 'mb-6';
                    
                    const header = document.createElement('h3');
                    const percentage = Math.round((count / participants.length) * 100);
                    header.className = 'font-medium text-lg mb-2';
                    header.innerHTML = `<span class="text-green-700">${count}/${participants.length}</span> people available (${percentage}%)`;
                    group.appendChild(header);
                    
                    const datesContainer = document.createElement('div');
                    datesContainer.className = 'flex flex-wrap gap-2';
                    
                    groupedDates[count].forEach(item => {
                        const dateCard = document.createElement('div');
                        dateCard.className = 'bg-white border rounded-lg p-3 shadow-sm cursor-pointer hover:bg-gray-50';
                        
                        const dateHeader = document.createElement('div');
                        dateHeader.className = 'font-medium text-indigo-800 mb-2';
                        dateHeader.textContent = formatDisplayDate(item.date);
                        dateCard.appendChild(dateHeader);
                        
                        const peopleList = document.createElement('div');
                        peopleList.className = 'text-sm text-gray-600';
                        peopleList.textContent = item.people.join(', ');
                        dateCard.appendChild(peopleList);
                        
                        // Add click handler to highlight this date on the calendar
                        dateCard.addEventListener('click', () => {
                            // Scroll to calendar
                            calendarGrid.scrollIntoView({ behavior: 'smooth' });
                            
                            // Find the month of this date
                            const dateObj = new Date(item.date);
                            if (dateObj.getMonth() !== currentDate.getMonth() || 
                                dateObj.getFullYear() !== currentDate.getFullYear()) {
                                // Update calendar to show this month
                                currentDate = new Date(dateObj.getFullYear(), dateObj.getMonth(), 1);
                                renderCalendar();
                            }
                            
                            // Flash highlight the date cell
                            setTimeout(() => {
                                const dateCell = document.querySelector(`.calendar-day[data-date="${item.date}"]`);
                                if (dateCell) {
                                    dateCell.classList.add('highlight-date');
                                    setTimeout(() => {
                                        dateCell.classList.remove('highlight-date');
                                    }, 2000);
                                }
                            }, 300);
                        });
                        
                        datesContainer.appendChild(dateCard);
                    });
                    
                    group.appendChild(datesContainer);
                    commonDates.appendChild(group);
                });
            }
            
            function renderSubmissionLog() {
                submissionLogElement.innerHTML = '';
                
                if (submissionLog.length === 0) {
                    const emptyMessage = document.createElement('p');
                    emptyMessage.className = 'text-gray-500 italic';
                    emptyMessage.textContent = 'No submission activity yet';
                    submissionLogElement.appendChild(emptyMessage);
                    return;
                }
                
                // Sort log entries by timestamp (newest first)
                const sortedLog = [...submissionLog].sort((a, b) => {
                    return new Date(b.timestamp) - new Date(a.timestamp);
                });
                
                sortedLog.forEach(entry => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry bg-gray-50 rounded-lg p-3 border-l-4 border-blue-500';
                    
                    const timestamp = new Date(entry.timestamp);
                    const formattedDate = timestamp.toLocaleDateString();
                    const formattedTime = timestamp.toLocaleTimeString();
                    
                    let actionText = '';
                    let actionClass = '';
                    
                    switch(entry.action) {
                        case 'submitted':
                            actionText = 'submitted availability';
                            actionClass = 'text-green-600';
                            break;
                        case 'updated':
                            actionText = 'updated availability';
                            actionClass = 'text-blue-600';
                            break;
                        case 'removed':
                            actionText = 'was removed';
                            actionClass = 'text-red-600';
                            break;
                    }
                    
                    logEntry.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="font-medium">${entry.name}</span> 
                                <span class="${actionClass}">${actionText}</span>
                                ${entry.action !== 'removed' ? `<span class="text-gray-600">(${entry.dateCount} dates)</span>` : ''}
                            </div>
                            <div class="text-xs text-gray-500">${formattedDate} at ${formattedTime}</div>
                        </div>
                    `;
                    
                    submissionLogElement.appendChild(logEntry);
                });
            }
            
            function highlightCommonDates() {
                if (participants.length < 2) return;
                
                // Count availability for each date
                const dateAvailability = {};
                
                participants.forEach(participant => {
                    participant.dates.forEach(date => {
                        if (!dateAvailability[date]) {
                            dateAvailability[date] = 0;
                        }
                        dateAvailability[date]++;
                    });
                });
                
                // Find the maximum availability count
                const maxCount = Math.max(...Object.values(dateAvailability));
                
                // Highlight dates with the maximum count
                if (maxCount > 1) {
                    Object.keys(dateAvailability).forEach(date => {
                        if (dateAvailability[date] === maxCount) {
                            const dateCell = document.querySelector(`.calendar-day[data-date="${date}"]`);
                            if (dateCell) {
                                const indicator = document.createElement('div');
                                indicator.className = 'absolute top-0 right-0 w-3 h-3 bg-green-500 rounded-full transform translate-x-1 -translate-y-1';
                                dateCell.style.position = 'relative';
                                dateCell.appendChild(indicator);
                            }
                        }
                    });
                }
            }
            
            function formatDate(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }
            
            function formatDisplayDate(dateString) {
                const date = new Date(dateString);
                const options = { weekday: 'short', month: 'short', day: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            }
            
            function saveToLocalStorage() {
                try {
                    localStorage.setItem('dateAvailabilityData', JSON.stringify({
                        participants: participants,
                        submissionLog: submissionLog
                    }));
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }
            }
            
            function loadFromLocalStorage() {
                try {
                    const savedData = localStorage.getItem('dateAvailabilityData');
                    if (savedData) {
                        const parsedData = JSON.parse(savedData);
                        participants = parsedData.participants || [];
                        submissionLog = parsedData.submissionLog || [];
                    }
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                    participants = [];
                    submissionLog = [];
                }
            }
            
            function showToast(message) {
                toast.textContent = message;
                toast.classList.remove('hidden');
                
                // Remove the toast after animation completes
                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 3500);
            }
            
            // Initial renders
            renderParticipants();
            renderDetailedAvailability();
            renderCommonDates();
            renderSubmissionLog();
        });
    </script>
</body>
</html>
